<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-on.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js">
      <style>
    .container {
      margin: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table,
    th,
    td {
      border: 1px solid black;
    }

    th,
    td {
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #ffdead;
    }

    .order-details {
      display: none;
    }

    .confirmed {
      background-color: #d4edda;
      /* ç»¿è‰²èƒŒæ™¯ï¼Œè¡¨ç¤ºå·²ç¡®è®¤ä»˜æ¬¾ */
    }

    .not-confirmed {
      background-color: #f8d7da;
      /* çº¢è‰²èƒŒæ™¯ï¼Œè¡¨ç¤ºæœªç¡®è®¤ä»˜æ¬¾ */
    }


    .product-container {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
    }

    .product {
      flex: 0 0 auto;
      width: 300px;
      /* èª¿æ•´ç”¢å“å¡ç‰‡å¯¬åº¦ */
      scroll-snap-align: center;
    }

    .product img {
      max-width: 100%;
      height: auto;
      cursor: pointer;
    }


    .product {
      border: 1px solid #ccc;
      padding: 10px;
      display: inline-block;
      margin: 10px;
      text-align: center;
    }

    .product img {
      max-width: 200px;
      height: auto;
    }

    #cart {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
    }

    #cart-items {
      list-style-type: none;
      padding: 0;
    }

    #cart-items li {
      margin-bottom: 5px;
    }

    .quantity-input {
      width: 80px;
      /* è¨­å®šå¯¬åº¦ç‚º 250 åƒç´  */
      padding: 2px;
      /* æ·»åŠ ä¸€äº›å…§é‚Šè· */
    }

    /* æ–°å¢æŒ‰å£“æ•ˆæœå’Œé¡è‰²è®ŠåŒ– */
    .btn-btn-primary {
      background-color: green;
      color: white;
      max-width: 350px;
      height: auto;
      cursor: pointer;
      ont-size: 25px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .btn-btn-primary:hover,
    .btn-btn-primary:active {
      background-color: #ff7f50;
      color: black;
    }
  </style>
</head>

<body>
  <base target="_top">
  <title>LINE ä½¿ç”¨è€…è³‡è¨Š</title>

  <div>
    <p>LINEä½¿ç”¨è€…ID: <span id="user-id"></span></p>
    <p>LINEä½¿ç”¨è€…åç¨±: <span id="user-name"></span></p>
  </div>

  <div class="container" id="loginFormB"
    style="display: none; background-color: #7fffd4; max-width: 550px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1 class="text-center">â­ï¸ ç¦æ°£è£œçµ¦ç«™ â­ï¸</h1>
    <button type="button" onclick="allonclickA()" onmouseup="this.style.backgroundColor='green'" onmousedown="this.style.backgroundColor='#ff0000'"
      style="font-size: 35px; text-align: center; max-width: 550px; background-color: #00bfff; color: white; border-radius: 8px;">å‰å¾€è³¼ç‰©!!</button>
    <button type="button" onclick="searchOrders()" onmouseup="this.style.backgroundColor='green'" onmousedown="this.style.backgroundColor='#ff0000'"
      style="font-size: 35px; text-align: center; max-width: 550px; background-color: #00bfff; color: white; border-radius: 8px;">è¨‚å–®æŸ¥å°‹!!</button>
    <div id="result"
      style="display: block; background-color: #afeeee; max-width: 550px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    </div>
    <h1 class="text-center" style="font-size: 20px; text-align: right;"> å°ç·¨ : å½¤å½¤çˆ¸ </h1>
  </div>

  <div class="container" id="loginFormB2"
    style="display: none; background-color: #7fffd4; max-width: 550px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1 class="text-center">â­ï¸ ç¦æ°£è£œçµ¦ç«™ â­ï¸</h1>
    <button type="button" onclick="searchOrders()" onmouseup="this.style.backgroundColor='green'" onmousedown="this.style.backgroundColor='#ff0000'"
      style="font-size: 35px; text-align: center; max-width: 350px; background-color: #00bfff; color: white; border-radius: 8px;">è¨‚å–®æŸ¥å°‹!!</button>
    <div id="result"
      style="display: block; background-color: #afeeee; max-width: 550px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    </div>
    <h1 class="text-center" style="font-size: 20px; text-align: right;"> å°ç·¨ : å½¤å½¤çˆ¸ </h1>
  </div>

  <div class="container" id="loginFormB2"
    style="display: none; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1 class="text-center" id="userName">æ‚¨å¥½\+\</h1>
     <input type="text" id="memberInput" placeholder="è¼¸å…¥åå­—" value="${currentA2Value}" style="font-size: 18px; color: #0000cd; line-height: 0.5; font-weight: bold; border-radius: 8px;">
    <h1 class="text-center"> æ­¡è¿é€²å…¥ </h1>
    <h1 class="text-center">â­ï¸ ç¦æ°£è£œçµ¦ç«™ â­ï¸</h1>
  </div>

  <div class="container" id="loginFormA"
    style="display: block; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1 class="text-center">â­ï¸ ç™»å…¥è¨‚è³¼ç³»çµ± â­ï¸</h1>
    <form id="loginForm">
      <div class="mb-3">
        <label for="phone" class="form-label" style="font-size: 25px; border-radius: 8px;">å¸³è™Ÿ</label>
        <input type="tel" class="form-control" id="phone" required style="font-size: 25px;">
      </div>
      <div class="mb-3">
        <label for="password" class="form-label" style="font-size: 25px; border-radius: 8px;">å¯†ç¢¼</label>
        <input type="tel" class="form-control" id="password" required style="font-size: 25px;">
      </div>
      <br>
      <button type="submit" id="loginButton" onmousedown="background-color:'#ff0000'" style="font-size: 25px; max-width: 350px; background-color: green; color: white; border-radius: 8px;">ç™»å…¥</button>
      <br>
      <h2>â­•ï¸ æ–°æœƒå“¡è«‹å…ˆè¨»å†Š</h2>
      <button type="button" onclick="allonclickE()"
        style="font-size: 25px; max-width: 350px; background-color: green; color: white; border-radius: 8px;">è¨»å†Š</button>
      <!-- <h2>â­•ï¸ è¨‚å–®æŸ¥è©¢</h2>
      <button type="button" onclick="allonclickC()"
        style="font-size: 25px; max-width: 350px; background-color: green; color: white; border-radius: 8px;">å€‹äººè¨‚å–®æŸ¥è©¢</button> -->
    </form>
  </div>

  <form id="signupForm"
    style="display: none; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">

    <h2>âœ…å¸³è™Ÿ ï¼š </h2>
    <h2>ã€å¤šç‰¹ç‘IDã€‘</h2>
    <input type="tel" id="set4" name="set4"
      style="color: blue; font-size: 25px; margin-bottom: 5px; font-weight: bold;">
    <h2>ã€å¯†ç¢¼ã€‘</h2>
    <input type="tel" id="set5" name="set5"
      style="color: blue; font-size: 25px; margin-bottom: 5px; font-weight: bold;">
    <button type="button" onclick="allonclick()" class="btn-btn-primary"
      style="font-size: 25px; background-color: green; color: white; border-radius: 8px;">ç¢ºèª</button>
    <button type="button" onclick="allonclickD()" class="btn-btn-primary"
      style="font-size: 25px; background-color: green; color: white; border-radius: 8px;">è¿”å›ç™»å…¥</button>
  </form>

  <div id="member-name" style="display: none;">
  </div>
  <div id="products" style="display: none;">
  </div>

  <div class="container" id="productsB"
    style="display: none; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1 class="text-center">â­ï¸ å·²åŠ å…¥è³¼ç‰©è»Š â­ï¸</h1>
    <button type="button" onclick="allonclickA()" class="btn-btn-primary"
      style="font-size: 35px; text-align: center; max-width: 350px; background-color: #00bfff; color: white; border-radius: 8px;">å¥åº·~ GO !!</button>
    <h1 class="text-center" style="font-size: 20px; text-align: right;"> å°ç·¨ : å½¤å½¤çˆ¸ </h1>
  </div>

  <div id="cart"
    style="display: none; background-color: #ffc0cb; max-width: 600px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h1>è³¼ç‰©è»Š</h1>

    <ul id="cart-items"></ul>
    <p id="total" style="font-size: 25px;  color: #ff0000; ">ç¸½è¨ˆ: $0</p>

    <button onclick="allonclickA()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #ff8c00; color: white; border-radius: 8px;">ç¹¼çºŒè³¼ç‰©</button>
    <button onclick="saveCart()" id="btnbtnA1" style="font-size: 25px; max-width: 350px; background-color: #ff1493; color: white; border-radius: 8px;">çµå–®è¨‚è³¼</button>
    <button onclick="allonclickF()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #00bfff; color: white; border-radius: 8px;">è¨‚å–®æŸ¥è©¢</button>
    <button onclick="clearCart()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: green; color: white; border-radius: 8px;">æ¸…è³¼ç‰©è»Š</button>
  </div>




  <!-- <div id="order-lookup"
    style="display: none; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h3>æŸ¥è©¢è¨‚å–®</h3>
    <input type="text" id="order-number-input" placeholder="è¼¸å…¥æœƒå“¡ID" style="color: blue; font-size: 25px; margin-bottom: 5px; font-weight: bold; border-radius: 8px;">
    <br>
    <button onclick="lookupOrder()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #00bfff; color: white; border-radius: 8px;">æŸ¥è©¢</button>
    <div id="order-details"
      style="display: block; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    </div>
    <button onclick="allonclickA()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #00bfff; color: white; border-radius: 8px;">å‰å¾€è³¼ç‰©</button>
  </div> -->


  <!-- <div class="container">
    <h1>è¨‚å–®æŸ¥è©¢</h1>
    <label for="memberID">æœƒå“¡ID:</label>
    <input type="text" id="memberID" name="memberID">
    <button onclick="searchOrders()">æŸ¥è©¢</button>

    <div id="result"></div>
  </div> -->


  <div id="order-lookup"
    style="display: none; background-color: #ffc0cb; max-width: 600px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h3>ç®¡ç†å“¡å°ˆç”¨</h3>
    <input type="text" id="memberID2" placeholder="æœƒå“¡ID" style="color: blue; font-size: 25px; margin-bottom: 5px; font-weight: bold; border-radius: 8px;">
    <br>
    <button onclick="searchOrders()" class="btn-btn-primary" style="font-size: 25px; max-width: 550px; background-color: #00bfff; color: white; border-radius: 8px;">æŸ¥è©¢</button>
    <div id="result"
      style="display: block; background-color: #ffc0cb; max-width: 350px; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    </div>
    <button onclick="allonclickA()" class="btn-btn-primary" style="font-size: 25px; max-width: 550px; background-color: #00bfff; color: white; border-radius: 8px;">å›é¦–é </button>
  </div>



  <script>
        function initializeLiff(myLiffId) {
          liff
            .init({
              liffId: myLiffId
            })
            .then(() => {
              if (!liff.isLoggedIn()) {
                liff.login();
              } else {
                getUserProfile();
              }
            })
            .catch((err) => {
              console.log(err);
            });
        }

        function getUserProfile() {
          liff.getProfile()
            .then(profile => {
              document.getElementById("userId").innerHTML = 'User ID: ' + profile.userId;
              document.getElementById("displayName").innerHTML = 'Display Name: ' + profile.displayName;
            })
            .catch((err) => {
              console.log('error', err);
            });
        }

        // æ›¿æ› "YOUR_LIFF_ID" ç‚ºæ‚¨çš„å¯¦éš› LIFF ID
        initializeLiff("YOUR_LIFF_ID");
    

    function displayLineUserInfo() {
    var urlParams = new URLSearchParams(window.location.search);
    var userId = urlParams.get('userId');
    var userName = urlParams.get('userName');

    document.getElementById('user-id').textContent = userId;
    document.getElementById('user-name').textContent = userName;
  }

  window.onload = displayLineUserInfo;




    // JavaScript å‡½æ•¸ä¾†æ›´æ”¹æŒ‰éˆ•çš„é¡è‰²å’Œæ–‡å­—
    function changeColorAndTextDN() {
        var button = document.getElementById('loginButton');
        
            // æ›´æ”¹æŒ‰éˆ•çš„é¡è‰²
            button.style.backgroundColor = '#008cba'; // ä½ æƒ³è¦çš„é¡è‰²

            // æ›´æ”¹æŒ‰éˆ•çš„æ–‡å­—
            button.innerHTML = 'ç™»å‡º';       
        
        // åœ¨é€™è£¡ä½ å¯ä»¥æ·»åŠ å…¶ä»–æƒ³è¦çš„æ“ä½œï¼Œä¾‹å¦‚ç™¼é€è«‹æ±‚ç­‰ç­‰
    }

   

    // <ç™»å…¥ç³»çµ±============================================================================================ç™»å…¥ç³»çµ±>
    document.getElementById('loginFormA').addEventListener('submit', function (event) {
      event.preventDefault(); // é˜²æ­¢è¡¨å–®æäº¤

      // ç²å–è¡¨å–®å€¼
      var phone = document.getElementById('phone').value;
      var password = document.getElementById('password').value;


      // èª¿ç”¨ Google Apps Script å‡½æ•¸é©—è­‰ç”¨æˆ¶
      google.script.run.withSuccessHandler(loginUser).loginUser(phone, password);

      google.script.run.withSuccessHandler().getData(phone);

      google.script.run.withSuccessHandler().lookupOrder()
    });

    function loginSuccess(memberData) {
  // åœ¨é€™è£¡è™•ç†æœƒå“¡è³‡æ–™
  const memberName = memberData.name; // å‡è¨­ memberData åŒ…å«æœƒå“¡å§“å
  const memberPhone = memberData.phone; // å‡è¨­ memberData åŒ…å«æœƒå“¡é›»è©±

  // æ›´æ–°é é¢ä¸Šçš„æœƒå“¡è³‡è¨Š
  document.getElementById('member-name').textContent = `æœƒå“¡: ${memberName}`;
  document.getElementById('phone').textContent = `æœƒå“¡ID: ${memberPhone}`;

  // æˆ–è€…åŸ·è¡Œå…¶ä»–æ“ä½œ,ä¾‹å¦‚ç²å–æœƒå“¡è¨‚å–®æ­·å²ç­‰
}

    function loginUser(result) {
      if (result) {
        // é¡¯ç¤ºæˆåŠŸæ¶ˆæ¯
        document.getElementById('loginFormB').style.display = 'block';
        document.getElementById('loginFormA').style.display = 'none';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'none';

        
       // æ›´æ”¹ç™»å…¥æŒ‰éˆ•çš„æ–‡å­—ç‚º "ç™»å‡º"
    document.getElementById('loginButton').textContent = 'ç™»å‡º';

        alert('ğŸ‰ç™»å…¥æˆåŠŸï¼');
        google.script.run.withSuccessHandler(loginSuccess).getData(phone, password);
      } else {

        é¡¯ç¤ºéŒ¯èª¤æ¶ˆæ¯
        alert('â—ï¸éŒ¯èª¤çš„å¸³è™Ÿæˆ–å¯†ç¢¼');
      }
    }
// <ç™»å…¥ç³»çµ±============================================================================================ç™»å…¥ç³»çµ±>

    function allonclickA() {
      
      // ç²å–è¡¨å–®å€¼
      var phone = document.getElementById('phone').value;

        document.getElementById('loginFormB').style.display = 'none';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'block';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'none';

    }

    function allonclickB() {
        document.getElementById('loginFormB').style.display = 'none';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'block';
        document.getElementById('order-lookup').style.display = 'none';
    }


    function allonclickC() {
        document.getElementById('loginFormB').style.display = 'none';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'block';
    }

    function allonclickD() {
      document.getElementById('loginFormB').style.display = 'none';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'none';
    }
    function allonclickE() {
      document.getElementById('loginFormB').style.display = 'none';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'block';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'none';
    }

    function allonclickF() {
      document.getElementById('loginFormB').style.display = 'block';
        document.getElementById('loginFormB2').style.display = 'none';
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('member-name').style.display = 'none';        
        document.getElementById('products').style.display = 'none';
        document.getElementById('cart').style.display = 'none';
        document.getElementById('order-lookup').style.display = 'none';
    }

    //  <ç™»å…¥ç³»çµ±============================================================================================ç™»å…¥ç³»çµ±>

    //  <è¨»å†Šç³»çµ±============================================================================================è¨»å†Šç³»çµ±>
    function allonclick() {
      getValuesA();
      }
   

    function getValuesA() {
      const getValue = (id) => document.getElementById(id).value;
      // const set1 = getValue('set1');
      // const set2 = getValue('set2');
      // const set3 = getValue('set3');
      const set4 = getValue('set4');
      const set5 = getValue('set5');

      const rowData = { set4, set5 };

      // æ£€æŸ¥ç”µè¯å·ç æ˜¯å¦é‡å¤
      var phoneN = "H" + rowData.set4;
      google.script.run.withSuccessHandler(function (isDuplicate) {
        if (isDuplicate) {
          alert("è©²é›»è©±è™Ÿç¢¼å·²è¢«è¨»å†Šéï¼Œè«‹ä½¿ç”¨å…¶ä»–è™Ÿç¢¼ã€‚");
        } else {
          const isConfirmed = confirm("ç¢ºå®šè¦è¨»å†Šï¼Ÿ");
          if (isConfirmed) {
            google.script.run.withSuccessHandler(function () {
              document.getElementById("signupForm").reset();
              getRegistrationList();
              updateItemDetails();
              showData();
            }).addData(rowData);
            google.script.run.checkDuplicatePhoneNumber(phoneN)
            document.getElementById('loginFormA').style.display = 'block';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('products').style.display = 'none';
            document.getElementById('cart').style.display = 'none';
            document.getElementById('order-lookup').style.display = 'none';
          }
        }
      }).checkDuplicatePhoneNumber(phoneN);
    }




    function getValuesB() {
      const getValueB = (id) => document.getElementById(id).value;
      const sport1 = getValueB('sport1');
      const sport2 = getValueB('sport2');
      const sport3 = getValueB('sport3');
      const sport4 = getValueB('sport4');
      const sport5 = getValueB('sport5');

      if (!sport1 || !sport2 || !sport3 || !sport4 || !sport5) {
        alert("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ã€‚");
        return;
      }


      const rowData2 = { sport1, sport2, sport3, sport4, sport5 };
      const isConfirmed = confirm("ç¢ºå®šè¨»å†Šå—ï¼Ÿ");

      if (isConfirmed) {
        google.script.run.withSuccessHandler(function () {
          document.getElementById("sportFormA").reset();
        }).addDataB(rowData2);
      }
    }


    function getRegistrationList() {
      google.script.run.withSuccessHandler(function (signupList) {
        displaySignupList(signupList);
      }).getSignupList();
    }

    function displaySignupList(signupList) {
      var table = document.getElementById('signupTable');
      table.innerHTML = '';  // æ¸…ç©ºè¡¨æ ¼

      signupList.forEach(row => {
        var newRow = table.insertRow();
        row.forEach(cell => {
          var newCell = newRow.insertCell();
          newCell.textContent = cell;
        });
      });
    }





    //  <è¨»å†Šç³»çµ±============================================================================================è¨»å†Šç³»çµ±>


    // åŸå§‹ç”¢å“æ•¸æ“š
    var allProducts = [];
     // è³¼ç‰©è»Šé …ç›®
    var cartItems = [];


    // å¾ GAS ç²å–ç”¢å“æ•¸æ“š
    google.script.run.withSuccessHandler(function (products) {
      allProducts = products;
      
      displayProducts(products);
    }).getProducts();

    
function displayProducts(products) {
  var html = '';
  for (var i = 0; i < products.length; i++) {
    var product = products[i];
    var isProductInCart = cartItems.some(item => item.id === product.id);
    html += '<div class="product">';
    html += '<img id="' + product.image + '" src="' + product.image + '" onclick="toggleImageSize(\'' + product.image + '\')" style="color:#0000ff; max-width: 50%; height: auto; cursor: pointer;" >';
    html += '<h3 style="font-size: 25px; color: #0000cd; line-height: 0.5;">' + product.name + '</h3>';
    html += '<h3 style="font-size: 25px; color: #0000cd; line-height: 0.5;">' + product.spsetA + '</h3>';
    html += '<p style="font-size: 25px; color: #0000cd; line-height: 0.5;">å–®åƒ¹: $' + product.price + '</p>';
    html += '<button id="addToCartBtn' + product.id + '" onclick="addToCart(' + product.id + ')" style="font-size: 25px; max-width: 350px; background-color: #ffa500; color: white; border-radius: 8px;">åŠ å…¥è³¼ç‰©è»Š</button>';
    html += '<button onclick="allonclickB()" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #3cb371; color: #333; border-radius: 8px;">å‰å¾€è³¼ç‰©è»Š</button>';
    html += '</div>';
  }
  document.getElementById('products').innerHTML = html;
}

function addToCart(productId) {
  var product = allProducts.find(function (p) { return p.id == productId; });
  if (product) {
    product.quantity = 1;
    cartItems.push(product);
    updateCart();

    // è·å–å¯¹åº”äº§å“çš„æŒ‰é’®å…ƒç´ 
    var button = document.getElementById('addToCartBtn' + product.id);
    if (button) {
      button.innerHTML = 'å·²åŠ å…¥è³¼ç‰©è»Š';
      button.disabled = true;
      button.classList.add('added');
      button.style.backgroundColor = '#ff1493';
    }
  }
}


function removeFromCart(index) {
  var product = cartItems[index];
  var productId = product.id;
  cartItems.splice(index, 1);
  updateCart();

  // å¾è¢«é¸æ“‡çš„ç”¢å“ä¸­ç§»é™¤ selected é¡
  var productElement = document.getElementById('product' + productId);
  if (productElement) {
    productElement.classList.remove('selected');
  }

  // ç²å–å°æ‡‰ç”¢å“çš„æŒ‰éˆ•å…ƒç´ 
  var button = document.getElementById('addToCartBtn' + productId);

  // å¦‚æœæ‰¾åˆ°äº†æŒ‰éˆ•å…ƒç´ 
  if (button) {
    // æ›´æ–°æŒ‰éˆ•æ–‡æœ¬ç‚º"åŠ å…¥è³¼ç‰©è»Š"
    button.innerHTML = 'åŠ å…¥è³¼ç‰©è»Š';
    button.disabled = false; // å•Ÿç”¨æŒ‰éˆ•
    button.classList.remove('added'); // ç§»é™¤æ¨£å¼é¡
    button.style.backgroundColor = '#ffa500';
  }
}

    function updateQuantity(index, quantity) {
      cartItems[index].quantity = parseInt(quantity);
      updateCart();
    }


var originalSize = false;

    function toggleImageSize(imageId) {
      var img = document.getElementById(imageId); // ç²å–é»æ“Šçš„åœ–åƒå…ƒç´ 
      if (originalSize) {
        img.style.maxWidth = "100%"; // å°‡åœ–ç‰‡çš„æœ€å¤§å¯¬åº¦è¨­ç½®ç‚ºå±å¹•å¯¬åº¦
        img.style.height = "auto"; // è®“åœ–ç‰‡çš„é«˜åº¦éš¨æ¯”ä¾‹è‡ªå‹•èª¿æ•´
      } else {
        img.style.maxWidth = "50%"; // å°‡åœ–ç‰‡çš„æœ€å¤§å¯¬åº¦è¨­ç½®ç‚ºä¸€åŠå±å¹•å¯¬åº¦
        img.style.height = "auto"; // è®“åœ–ç‰‡çš„é«˜åº¦éš¨æ¯”ä¾‹è‡ªå‹•èª¿æ•´
      }
      originalSize = !originalSize;
    }
    

    function updateCart() {
      var cartItemsHtml = '';
      var total = 0;

      if (cartItems.length === 0) {
        cartItemsHtml = '<li style="font-size: 25px; color: #0000cd; line-height: 0.5;">è³¼ç‰©è»Šæ˜¯ç©ºçš„</li>';
      } else {
        for (var i = 0; i < cartItems.length; i++) {
          var item = cartItems[i];
          var itemQuantity = item.quantity || 1; // ä½¿ç”¨ quantity æˆ–é è¨­å€¼ 1
          var itemTotal = Math.round(item.price) * itemQuantity;
          total += itemTotal;

          cartItemsHtml += '<li>';
          cartItemsHtml += `<h4 style="font-size: 25px; color: #0000cd; line-height: 0.5;">âœ…${item.id} + ${item.name} </h4>`;
          cartItemsHtml += `<h4 style="font-size: 25px; color: #0000cd; line-height: 0.5;">ğŸŸ å–®åƒ¹ : ${Math.round(item.price)}</h4>`;         
          cartItemsHtml +=  '<span style="font-size: 25px; color: #0000cd; line-height: 0.5; font-weight: bold;">ğŸŸ¡è¨‚è³¼æ•¸é‡: </span><input class="quantity-input" type="number" value="' + itemQuantity + '" onchange="updateQuantity(' + i + ', this.value)" style="font-size: 25px; color: #0000cd; line-height: 0.5; font-weight: bold;">';
          cartItemsHtml += `<h4 style="font-size: 25px; color: #0000cd; line-height: 0.5;"> = $${Math.round(itemTotal.toFixed(2))}</h4>`; 
          cartItemsHtml += '<button onclick="removeFromCart(' + i + ')" class="btn-btn-primary" style="font-size: 25px; max-width: 350px; background-color: #ff69b4; color: #333; border-radius: 8px;">åˆªé™¤</button>';
          cartItemsHtml += '<br>';
          cartItemsHtml += '<br>';
          cartItemsHtml += '</li>';
        }
      }

      document.getElementById('cart-items').innerHTML = cartItemsHtml;
      document.getElementById('total').innerHTML = 'ç¸½è¨ˆ: $' + (Math.round(total.toFixed(2))); // å°‡ "Total" æ”¹ç‚º "ç¸½è¨ˆ"

    }
    // â¡ï¸â–¶ï¸âš ï¸ğŸ‘‰ğŸŒ¸â­ï¸ğŸŒŸâœ¨â˜ï¸â°ğŸ”‹ğŸ’µğŸ”‘ğŸğŸ“’ğŸ—‚ï¸ğŸ“šğŸ“ğŸ“ŒğŸ“ğŸ”–ğŸ“–âœï¸ğŸ©·
    // â¤ï¸ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ–¤ğŸ¤ğŸ’—ğŸ’“ğŸ’ğŸ’ğŸ’˜ğŸ’–
    // ğŸˆ¶ğŸˆšï¸ğŸ‰‘ğŸ†šâ­•ï¸âŒğŸˆ²ğŸˆµâ—ï¸â€¼ï¸â“
    // â”â•ğŸˆ¯ï¸âœ…ââœ³ï¸â‡ï¸â¡ï¸â¬…ï¸â˜‘ï¸
    // ğŸ”´ğŸŸ âš«ï¸ğŸŸ£ğŸ”µğŸŸ¢ğŸŸ¡âšªï¸ğŸŸ¤
    // ğŸ”¸ğŸ”¹ğŸ”¶ğŸ”·
    // ğŸŸ©ğŸŸ¨ğŸŸ§ğŸŸ¥ğŸŸ¦ğŸŸªâ¬›ï¸ğŸŸ«â¬œï¸ğŸ’¬


    function clearCart() {
      // æ¸…ç©ºè³¼ç‰©è»Šé …ç›®
      cartItems = [];

      // æ›´æ–°è³¼ç‰©è»Šé¡¯ç¤º
      updateCart();
    }


    var nowTime = new Date();
    var year = nowTime.getFullYear();
    var month = append1Zero(nowTime.getMonth() + 1);
    var date = append1Zero(nowTime.getDate());
    var hours = append1Zero(nowTime.getHours());
    var minutes = append1Zero(nowTime.getMinutes());
    var prefixFileName2 = "è¨‚å–®ç·¨è™Ÿ#" + year + month + date + hours + minutes;


    function append1Zero(obj) {
      if (obj < 10) { return "0" + obj.toString(); }
      else { return obj.toString(); }
    }


// function saveCart() {
//       if (cartItems.length > 0) {
//         const currentOrderNumber = prefixFileName2;
//         google.script.run.withSuccessHandler(function () {
//           alert(`æ‚¨çš„è¨‚å–®å·²é€å‡ºï¼Œè¨‚å–®ç·¨è™Ÿç‚º #${currentOrderNumber}`);
//           orderNumber++; // åœ¨é€™è£¡å¢åŠ  orderNumber
//         }).saveCartToSpreadsheet(cartItems, currentOrderNumber);
//       } else {
//         alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„');
//       }
//     }




    function saveCart() {
      var phone = document.getElementById('phone').value;
      if (cartItems.length > 0) {
        const currentOrderNumber = prefixFileName2;
        var button = document.getElementById('btnbtnA1');
    if (button) {
      button.innerHTML = 'è¨‚å–®å®Œæˆ';
      button.disabled = true;
      button.classList.add('added');
      button.style.backgroundColor = '#ff1493';
    }
        google.script.run.withSuccessHandler(function () {
          
          orderNumber++; // åœ¨é€™è£¡å¢åŠ  orderNumber
        }).saveCartToSpreadsheet(cartItems, currentOrderNumber,phone);
      } else {
        alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„');
      }
    }



    function lookupOrder() {
      const orderNumber = document.getElementById('order-number-input').value;
      if (orderNumber) {
        google.script.run.withSuccessHandler(displayOrderDetails).getOrderDetails(orderNumber);
      } else {
        alert('è«‹è¼¸å…¥æœƒå“¡ID');
      }
    }

    function displayOrderDetails(orderDetails) {
      let totalPrice = 0; // å„²å­˜ç¸½é‡‘é¡çš„è®Šæ•¸
      updateCart(total);
      const orderNumber = document.getElementById('order-number-input').value;
      let html = '';
      if (orderDetails) {
        html += `<h4 style="font-size: 25px; color: #333;">â­•ï¸ æœƒå“¡ID: ${orderNumber} </h4>`;
        for (let i = 0; i < orderDetails.length; i++) {
          const item = orderDetails[i];
          const subtotal = item[2] * item[3]; // è¨ˆç®—æ¯é …å•†å“çš„å°è¨ˆ
          totalPrice += subtotal;

          html += `<h4 style="font-size: 20px; color: #0000cd; line-height: 0.5;">ğŸ“Œ ${item[0]} :</h4>`;
          html += `<h4 style="font-size: 20px; color: #0000cd; line-height: 0.5;">ğŸŸ© ${item[1]} :</h4>`;
          html += `<h4 style="font-size: 20px; color: #0000cd; line-height: 0.5;">ğŸŸ¡ _ ${item[2]} x ${item[3]} = $ ${item[4]} <br> </h4>`;
          html += `<div style="height: 0.5px;"></div>`;
        }         
        html += `<h4 style="font-size: 30px; color: #ff0000;">ğŸ“ ç¸½é‡‘é¡: $${totalPrice}</h4>`; // é¡¯ç¤ºç¸½é‡‘é¡
      } else {
        html += '<p>æ‰¾ä¸åˆ°è¨‚å–®</p>';
      }
      document.getElementById('order-details').innerHTML = html;
    }

      function showOrders() {
      var memberId = document.getElementById('memberId').value;
      google.script.run.withSuccessHandler(displayOrders).getOrders(memberId);
    }
    
    function displayOrders(orders) {
      var ordersDiv = document.getElementById('orders');
      ordersDiv.innerHTML = '';
      
      for (var orderId in orders) {
        var orderDiv = document.createElement('div');
        var orderHeader = document.createElement('h3');
        orderHeader.textContent = 'è¨‚å–®ç·¨è™Ÿ: ' + orderId;
        orderHeader.addEventListener('click', function() {
          toggleOrderDetails(this);
        });
        orderDiv.appendChild(orderHeader);
        
        var orderDetails = document.createElement('div');
        orderDetails.style.display = 'none';
        var table = document.createElement('table');
        var headerRow = document.createElement('tr');
        ['å“å', 'å–®åƒ¹', 'æ•¸é‡', 'åˆè¨ˆ'].forEach(function(header) {
          var th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);
        
        orders[orderId].forEach(function(item) {
          var row = document.createElement('tr');
          var nameTd = document.createElement('td');
          nameTd.textContent = item.name;
          row.appendChild(nameTd);
          var priceTd = document.createElement('td');
          priceTd.textContent = item.price;
          row.appendChild(priceTd);
          var quantityTd = document.createElement('td');
          quantityTd.textContent = item.quantity;
          row.appendChild(quantityTd);
          var totalTd = document.createElement('td');
          totalTd.textContent = item.total;
          row.appendChild(totalTd);
          table.appendChild(row);
        });
        orderDetails.appendChild(table);
        orderDiv.appendChild(orderDetails);
        ordersDiv.appendChild(orderDiv);
      }
    }
    
    function toggleOrderDetails(header) {
      var orderDetails = header.nextElementSibling;
      if (orderDetails.style.display === 'none') {
        orderDetails.style.display = 'block';
      } else {
        orderDetails.style.display = 'none';
      }
    }



  function searchOrders() {
       var memberID = document.getElementById('phone').value;
    if (memberID == "6568728"){
      google.script.run.withSuccessHandler(displayResults).getOrderData("H" + memberID);
    }
    else {      
      google.script.run.withSuccessHandler(displayResultsB).getOrderData("H" + memberID);
    }
    }

    function displayResults(data) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '';

      if (data.length === 0) {
        resultDiv.innerHTML = 'æ²’æœ‰æ‰¾åˆ°ç›¸é—œè¨‚å–®';
        return;
      }

      let html = '<table><tr><th>è¨‚å–®ç·¨è™Ÿ(æŒ‰å£“å³å¯å±•é–‹æ˜ç´°)<br>ç¹³è²»æ–¹å¼ / ç¢ºèª<br>å·²ç¢ºèªæ”¶æ¬¾</th><th>ç¸½é‡‘é¡</th>';
      const orders = {};
      data.forEach(order => {
        if (!orders[order.orderId]) {
          orders[order.orderId] = [];
        }
        orders[order.orderId].push(order);
      });

      Object.keys(orders).forEach(orderId => {
        const totalAmount = orders[orderId].reduce((sum, order) => sum + order.total, 0);
        const paymentMethod = orders[orderId][0].paymentMethod || "";
        const paymentConfirmed = orders[orderId][0].paymentConfirmed || false;
        html += `<tr>
                   <td>
                   <div>
                       <span style="font-size: 25px; max-width: 350px; background-color: #00bfff; color: black; border-radius: 8px; line-height: 1.6; text-decoration: none;">${orderId}</span>
                       <button onclick="toggleDetails(event, '${orderId}')" style="font-size: 20px; margin-left: 10px; background-color: #007bff; color: white; border-radius: 8px;">æ˜ç´°</button>
                     </div>                  
                   <br>
                    <input type="text" id="paymentMethod-${orderId}" value="${paymentMethod}" placeholder="è¼¸å…¥ç¹³è²»æ–¹å¼" style="font-size: 25px; color: #0000cd; width: 150px; line-height: 1.6; font-weight: bold; border-radius: 8px;">
                    <br>
                    <br>
                    <button onclick="savePaymentMethod('${orderId}')" style="font-size: 25px; max-width: 350px; background-color: #ffa500; color: white; border-radius: 8px;" line-height: 1.6>${paymentMethod ? 'å·²ç¹³è²»è«‹ç¢ºèª' : 'ç¢ºèªæ”¯ä»˜æ–¹å¼'}</button>
                   <br>
                   <br>
                     <button onclick="confirmPayment('${orderId}')" style="font-size: 25px; max-width: 350px; background-color: #ff00ff; color: white; border-radius: 8px;" line-height: 1.6>${paymentConfirmed ? 'å·²ç¢ºèª' : 'è«‹ç¢ºèªæ”¶æ¬¾'}</button>
                   </td>
                   
                   <td>${totalAmount}</td>                                     
                 </tr>
                 <tr id="details-${orderId}" class="order-details">
                   <td colspan="5">
                     <table>
                       <tr>
                         <th>å“å</th>
                         <th>å–®åƒ¹</th>
                         <th>æ•¸é‡</th>
                         <th>åˆè¨ˆ</th>
                       </tr>`;
        orders[orderId].forEach(order => {
          html += `<tr>
                     <td>${order.productName}</td>
                     <td>${order.price}</td>
                     <td>${order.quantity}</td>
                     <td>${order.total}</td>
                   </tr>`;
        });
        html += `</table>
                   </td>
                 </tr>`;
      });
      html += '</table>';

      resultDiv.innerHTML = html;
    }


    
    function displayResultsB(data) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '';

      if (data.length === 0) {
        resultDiv.innerHTML = 'æ²’æœ‰æ‰¾åˆ°ç›¸é—œè¨‚å–®';
        return;
      }

      let html = '<table><tr><th>è¨‚å–®ç·¨è™Ÿ(æŒ‰å£“å³å¯å±•é–‹æ˜ç´°)<br>ç¹³è²»æ–¹å¼ / ç¢ºèª<br>å·²ç¢ºèªæ”¶æ¬¾</th><th>ç¸½é‡‘é¡</th>';
      const orders = {};
      data.forEach(order => {
        if (!orders[order.orderId]) {
          orders[order.orderId] = [];
        }
        orders[order.orderId].push(order);
      });

      Object.keys(orders).forEach(orderId => {
        const totalAmount = orders[orderId].reduce((sum, order) => sum + order.total, 0);
        const paymentMethod = orders[orderId][0].paymentMethod || "";
        const paymentConfirmed = orders[orderId][0].paymentConfirmed || false;
        html += `<tr>
                   <td>
                   <div>
                       <span style="font-size: 25px; max-width: 350px; background-color: #00bfff; color: black; border-radius: 8px; line-height: 1.6; text-decoration: none;">${orderId}</span>
                       <button onclick="toggleDetails(event, '${orderId}')" style="font-size: 20px; margin-left: 10px; background-color: #007bff; color: white; border-radius: 8px;">æ˜ç´°</button>
                     </div>                  
                   <br>
                    <input type="text" id="paymentMethod-${orderId}" value="${paymentMethod}" placeholder="è¼¸å…¥ç¹³è²»æ–¹å¼" style="font-size: 25px; color: #0000cd; width: 150px; line-height: 1.6; font-weight: bold; border-radius: 8px;">
                    <br>
                    <br>
                    <button onclick="savePaymentMethod('${orderId}')" style="font-size: 25px; max-width: 350px; background-color: #ffa500; color: white; border-radius: 8px;" line-height: 1.6>${paymentMethod ? 'å·²ç¹³è²»è«‹ç¢ºèª' : 'ç¢ºèªæ”¯ä»˜æ–¹å¼'}</button>
                   </td>
                   
                   <td>${totalAmount}</td>                                     
                 </tr>
                 <tr id="details-${orderId}" class="order-details">
                   <td colspan="5">
                     <table>
                       <tr>
                         <th>å“å</th>
                         <th>å–®åƒ¹</th>
                         <th>æ•¸é‡</th>
                         <th>åˆè¨ˆ</th>
                       </tr>`;
        orders[orderId].forEach(order => {
          html += `<tr>
                     <td>${order.productName}</td>
                     <td>${order.price}</td>
                     <td>${order.quantity}</td>
                     <td>${order.total}</td>
                   </tr>`;
        });
        html += `</table>
                   </td>
                 </tr>`;
      });
      html += '</table>';

      resultDiv.innerHTML = html;
    }





    function toggleDetails(event, orderId) {
      event.preventDefault();
      const detailsRow = document.getElementById(`details-${orderId}`);
      if (detailsRow.style.display === 'none' || detailsRow.style.display === '') {
        detailsRow.style.display = 'table-row';
      } else {
        detailsRow.style.display = 'none';
      }
    }

    function savePaymentMethod(orderId) {
      const paymentMethod = document.getElementById(`paymentMethod-${orderId}`).value;
      google.script.run.savePaymentMethod(orderId, paymentMethod);
      alert('ç¹³è²»æ–¹å¼å·²ä¿å­˜');
       searchOrders();
    }

    function confirmPayment(orderId) {
      google.script.run.withSuccessHandler(() => {
        alert('å·²ç¢ºèªæ”¶æ¬¾');
        searchOrders();
      }).confirmPayment(orderId);
    }
 

  </script>
  </body>

</html>
